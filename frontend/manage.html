<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Bookings | Nima Library</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="main-wrapper">
    <div class="container">
        
        <div class="header-section">
            <h1><i class="fa-solid fa-list-check"></i> My Dashboard</h1>
            <p class="subtitle">Check your reservation status</p>
        </div>

        <div class="card">
            <h3><i class="fa-solid fa-magnifying-glass"></i> Find Your Bookings</h3>
            <div class="input-group">
                <i class="fa-solid fa-id-card input-icon"></i>
                <input type="text" id="searchRollNo" placeholder="Enter Leader Roll Number">
            </div>
            <button class="main-btn" onclick="findBookings()">Check Status</button>
        </div>

        <div class="card">
            <h3><i class="fa-solid fa-calendar-check"></i> Active Bookings</h3>
            <div id="resultsContainer">
                <p style="text-align: center; color: #888; margin-top: 20px;">Enter your Roll Number to see details.</p>
            </div>
        </div>

        <div style="text-align: center; margin-top: 20px;">
            <a href="index.html" style="color: #666; text-decoration: none;">
                <i class="fa-solid fa-arrow-left"></i> Back to Home
            </a>
        </div>

    </div>
</div>

<script>
    const BACKEND_URL = "https://nima-backend.vercel.app"; // âœ… CHECK THIS

    async function findBookings() {
        const rollNo = document.getElementById('searchRollNo').value.trim();
        const container = document.getElementById('resultsContainer');

        if (!rollNo) {
            alert("Please enter a Roll Number");
            return;
        }

        container.innerHTML = `<p style="text-align:center;">Searching...</p>`;

        try {
            const res = await fetch(`${BACKEND_URL}/my-bookings?roll_no=${rollNo}`);
            const data = await res.json();

            if (data.bookings && data.bookings.length > 0) {
                container.innerHTML = ""; 
                data.bookings.forEach(b => {
                    const div = document.createElement('div');
                    div.style.background = "#f8f9fa";
                    div.style.padding = "15px";
                    div.style.borderRadius = "8px";
                    div.style.marginBottom = "10px";
                    div.style.borderLeft = "5px solid #27ae60";
                    
                    div.innerHTML = `
                        <h4 style="margin:0 0 5px 0;">${b.room_id}</h4>
                        <p style="margin:0; font-size:14px; color:#555;">
                            <i class="fa-regular fa-calendar"></i> ${b.date} &nbsp;|&nbsp; 
                            <i class="fa-regular fa-clock"></i> ${b.time_slot}
                        </p>
                        <div style="margin-top:5px; font-size:12px; font-weight:bold; color:#27ae60;">
                            <i class="fa-solid fa-circle-check"></i> Confirmed
                        </div>
                    `;
                    container.appendChild(div);
                });
            } else {
                container.innerHTML = `<p style="text-align:center; color:#888;">No bookings found for ${rollNo}</p>`;
            }
        } catch (err) {
            console.error(err);
            container.innerHTML = `<p style="text-align:center; color:red;">Error connecting to server.</p>`;
        }
    }
</script>
</body>
</html>